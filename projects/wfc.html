<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Mario Rodríguez Portfolio - WFC</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=https://fonts.googleapis.com/css?family=Inconsolata:400,500,600,700|Raleway:400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HSK7JMST2Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-HSK7JMST2Q');
  </script>
  
  <!-- =======================================================
  * Template Name: MyPortfolio - v4.10.0
  * Template URL: https://bootstrapmade.com/myportfolio-bootstrap-portfolio-website-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Navbar ======= -->
  <div class="collapse navbar-collapse custom-navmenu" id="main-navbar">
    <div class="container py-2 py-md-5">
      <div class="row align-items-start">
        <div class="col-md-2">
          <ul class="custom-menu">
            <li class="active"><a href="../index.html">Home</a></li>
            <li><a href="../about.html">About Me</a></li>
            <li><a href="../contact.html">Contact</a></li>
          </ul>
        </div>
        <div class="col-md-6 d-none d-md-block  mr-auto">
          <div>
            <!-- <div>
            <a href="https://twitter.com/mariorod_dev"><span class="bi bi-twitter text-white mt-2 mr-3"> </span> @mariorod_dev</a>
            </div> -->
            <div>
              <a href="https://www.linkedin.com/in/mario-rodriguez-chaves"><span class="bi bi-linkedin text-white mt-2 mr-3"></span> Mario Rodríguez Chaves</a>
            </div>
            <div>
              <a href="./assets/Rodriguez_Mario.pdf" target="_blank">Download my CV</a>
            </div>
          </div>
        </div>
        <!-- <div class="col-md-4 d-none d-md-block">
          <h3>Hire Me</h3>
          <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam necessitatibus incidunt ut officiisexplicabo inventore. <br> <a href="#">mario.rod.dev@gmail.com</a></p>
        </div> -->
      </div>

    </div>
  </div>

  <nav class="navbar navbar-light custom-navbar">
    <div class="container">
      <a class="navbar-brand" href="../index.html">MyPortfolio.</a>
      <a href="#" class="burger" data-bs-toggle="collapse" data-bs-target="#main-navbar">
        <span></span>
      </a>
    </div>
  </nav>

  <main id="main">

    <section class="section">
      <div class="container">
        <div class="row mb-4 align-items-center">
          <div class="col-md-6" data-aos="fade-up">
            <h2>Procedural world generation.</h2>
            <p class="mb-0"><span class="text-muted">Unity, AI, Procedural Generation</span></p>
            <p class="mb-4"><span class="text-muted">January, 2023 - In development</span></p>
            <p>Procedural generation of a hexagonal grid using the Wave Function Collapse algorithm. (Work in progress)</p>
          </div>
        </div>
      </div>

      <div class="site-section pb-0">
        <div class="container">
          <div class="row align-items-stretch">
            <div class="col-md-7" data-aos="fade-up">
              <img src="../assets/img//wfc/wfc.gif" width="560" height="300">
              <!-- <iframe width="560" height="300"
              src="https://www.youtube.com/embed/8bAvbA1r16U">
              </iframe> -->
            </div>
            <div class="col-md-5 ml-auto" data-aos="fade-up">
              <div class="sticky-content">
                <div class="mb-5">
                  <p>This project is currently in development. It is an AI simulation
                    where multiple agents must perform different tasks in a procedurally
                    generated hexagonal world. Multiple AI techniques have been used to
                    generate the world and bring to life the AI agents.
                  </p>

                  <h2>Features</h2>
                  <ul class="list-unstyled list-line mb-5">
                  <li>Procedural generation of a hexagonal grid world using the Wave Function Collapse algorithm.</li>
                  <li>Implementation of the A* Algorithm to create the paths between cities.</li>
                  </ul>

                  <h2>Features in development</h2>
                  <ul class="list-unstyled list-line mb-5">
                  <li>Simulation of simple agents that interact together</li>
                  <li>Refinement of the procedural generation to create more complex and believable worlds.</li>
                  <li>Implementation of a interactable demo to learn how the algorithm works</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="container">
          <div class="row mb-4 align-items-center">
            <div class="col-md-8">
              <h2>How I did it</h2>
              <h4>Design of the hexagonal grid.</h4>
              <p>
                For this demo I wanted to explore hexagonal grids, and how can they be implemented. I decided
                to have a grid generator as open as possible. Some of the features of this generator are:
              </p>
              <ul>
                <li>There are two ways to display an hexagon: top side flat (the 
                  top is an edge) or top side pointy (the top is a vertex). The 
                  generator handles both instances.</li>
                <li>It can generate two types of grid: rectangular (with x rows 
                  and y columns) or hexagonal (with n rings).</li>
                <li>The grid is composed of a series of Nodes that are linked 
                  to each others via Paths.</li>
                <li>The nodes are stored in a List, but traversing the list is 
                  not supported. The only way to traverse between Nodes is through
                  their paths.</li>
              </ul>

              <div class="row align-items-stretch">
                <div class="col-md-8" >
                  <img src="../assets/img/wfc/hex_grid.png" width="350" height="350">
                  <p>Hexagonal grid formation</p>
                </div>
                <div class="col-md-4 ml-auto">
                  <img src="../assets/img/wfc/squared_grid.png" width="350" height="350">
                  <p>Rectangular grid formation</p>
                </div>
              </div>
              <br>
              <p>
                As for the Node, it contains its position, a list of all the paths
                it shares with other Nodes and a reference to the tile (the 
                actual GameObject) it holds. On the other hand, a Path is a 
                connection between an in_node (the Node it belongs to),
                an out_node (the neighbouring Node) and a cost (for pathfinding 
                purposes).
                <br><br>
                This implementation works as it is but, in its current state, it
                is not very efficient. For instance, for each two adjacent Nodes,
                there are two different Paths, from one Node to the other and
                viceversa. This can be reducted two one Path and, when traversing,
                take into consideration the current node you are in. Another possible
                optimization could be to remove the Paths alltogether and use an
                adjacency matrix with the cost to move from one node to others.
              </p>

              <h4>Procedural generation of the world using the Wave Function Collapse Algorithm.</h4>
              <p>
                The <a href="https://github.com/mxgmn/WaveFunctionCollapse" target="_blank">Wave Function Collapse</a> 
                algorithm is a generative algorithm that is bases on the restrictions 
                between adjacent pixels/tiles. It has been widely used to generate 
                2D images, tilemaps and even 3D models.
                <br><br>
                My implementation of the algorithm is a mix of all the sources I 
                found when researching about the algorithm adapted to the hexagonal 
                grid that I am using and the overall idea of the world I want to 
                generate.
                <br><br>
                The first iteration of the algorithm that I implemented had as input:
                <ul>
                  <li>A list of the modules that could be placed in each tile.</li>
                  <li>A list of adjacency rules that dictaminated which module 
                    could be placed next to which module.
                  </li>
                  <li>A list with the weights of the modules. The bigger the weight,
                    the more probable a module is of being picked.
                  </li>
                </ul>
                This implementation was functional, but it was not escalable at all.
                For each module I added, I had to add all the adjacency rules between
                that module and the rest of the modules. With each module added, the 
                task became increasingly tiresome.
                <br><br>
                On the second iteration, I discarded the adjacency rules list entirely.
                Instead, I defined an enum of the types of elements that populated
                the map (grass, forest, mountains, cities, water, path, etc.) And,
                for each edge of the module, defined a list of compatible types 
                that could be placed next to that edge. For example, a forest edge
                can only be placed next to a forest edge, but a hill edge can be
                placed either next to a grass, a hill or a mountain edge.
                <br><br>
                With this implementation, I do not have to define the behaviour
                of each module with the rest of the modules. Now I just have to
                define, for each side of the new module, the compatible types. Making
                the task much more easy. Moreover, this change resulted in a huge
                optimization for the algorithm, as now I didn't have to search in
                the rules list for all the rules related to the tile.
              </p>

              <h4>Road generation using A*.</h4>
              <p>
                I want the cities generated to be connected between each others
                as naturally as possible. At first, I tried to generate the 
                roads with the WFC algorithm, however, this added so much
                complexity to the algorithm that the number of viable solutions
                dropped significantly. Moreover, the roads generated were not
                very natural, nor optimal.
                <br><br>
                Therefore, I decided to use an A* pathfinding algorithm to
                generate the roads between the cities. It is now in its first
                iteration and, for now, it only generates the optimal path
                between every city. This aproximation, even if it achieves the
                goal, does not take into account pre-existing roads. So you can
                find in a situation where two roads are parallel for a great
                distance to the same city, when they could have been merged.
                <br><br>
                I am currently working in a variation of the algorithm to resolve
                this issue. I am testing some of these options when generating
                a road from one city to another:
                <ul>
                  <li>Give priority to tiles that have already a path in it 
                    (lowering their cost for example).
                  </li>
                  <li>For each node explored, check all the neighbouring nodes and
                    if any is part of a road, check if the road leads to the target
                    city. If this is the case, merge with the road and end the search.
                  </li>
                  <li>For each node explored, check all the neighbouring nodes and,
                    if any node is a city, check if the city has already a road
                    to the target city. If this is the case, lead the road to that
                    city and end the search.
                  </li>
                </ul>
              </p>

              <img src="../assets/img/wfc/pathfinding.gif" width="550" height="320">
              <p>Current implementation of the pathfinder.</p>

            </div>
          </div>
        </div>

      </div>
    </section>
  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="row">
        <div class="col-sm-6">
          <p class="mb-1">&copy; Copyright Mario Rodríguez Chaves. All Rights Reserved</p>
          <div class="credits">
            <!--
            All the links in the footer should remain intact.
            You can delete the links only if you purchased the pro version.
            Licensing information: https://bootstrapmade.com/license/
            Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/buy/?theme=MyPortfolio
          -->
            Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
          </div>
        </div>
        <div class="col-sm-6 social text-md-end">
          <a href="https://twitter.com/mariorod_dev"><span class="bi bi-twitter"></span></a>
          <!--a href="#"><span class="bi bi-facebook"></span></a-->
          <!--a href="#"><span class="bi bi-instagram"></span></a-->
          <a href="https://www.linkedin.com/in/mario-rodriguez-chaves"><span class="bi bi-linkedin"></span></a>
        </div>
      </div>
    </div>
  </footer>

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>

</body>

</html>